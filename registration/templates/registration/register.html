{% load static %}
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>New Registratoin</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="{% static 'css/register.css' %}">
    </head>


    <body>
        <div class="background-image"></div>
        <div class="background-overlay"></div>
        
        <form action = "/register", method="post" enctype="multipart/form-data">
            {% csrf_token %}
              
              <!-- {{ form.sport.label }} {{ form.sport }} -->
<!-- 
              <label>Captcha: <b>{{ captcha_code }}</b></label>
            {{ form.captcha }} -->
            <h3>Candidate Registration</h3>

            <label for="">First name</label>{{ form.name.label }} {{ form.name }}
            <input type="text" id= "fname" name="fname" placeholder="Enter your first name" required> 
            <br>

            <label for="">Last name</label>
            <input type="text" id= "lname" name="lname" placeholder="Enter your last name" required>
            <br><br>
            
            <label for="">Email</label>
            <input type="email" id= "email" name="email" placeholder="Enter your email" required>
            <br><br>


            <!-- <label for="">Phone Number</label>
            <input type="tel" id="number" maxlength="10" step="none" name="number" placeholder="Enter your phone number" required >
            <br><br> -->
            <label for="number">Phone Number</label>
            <input type="tel" id="number" maxlength="10" name="number" placeholder="Enter your phone number" required>
        
            <div class="phone-verification">
                <button type="button" class="verify-btn" onclick="sendOTP()" id="send-otp-btn">
                    Send OTP
                </button>
                <span id="phone-status"></span>
            </div>
        
            <!-- OTP Input (initially hidden) -->
            <div id="otp-section" style="display: none; margin-top: 10px;">
                <input type="text" class="otp-input" id="otp-input" placeholder="Enter OTP" maxlength="6">
                <button type="button" class="verify-btn" onclick="verifyOTP()">Verify OTP</button>
                <div id="otp-status" class="status-message"></div>
            </div>

            <!-- Hidden field to track verification status -->
            <input type="hidden" id="phone-verified" name="phone_verified" value="false">

            <br><br>



            <label for="dob">Age</label>
            <input type="number" id="age" name="age" required>
            <br><br>

            <label for="">Date of birth</label>
            <input type="Date" id="dob" name="dob" required min="1980-01-01" max="2020-12-31">

            <label for ="">Gender</label>
            <select name="gender" id="gender">
                <option value="female">Female</option>
                <option value="male">Male</option>
                <option value="other">Other</option>
            </select>
            <br><br>

            <label for="">Photo</label>
            <input type="file" name="photo" accept="image/*">
            <br><br>
            <div class="doc">
                <label for="">Upload Documents</label>
                <br>*Upload relevent sports releted documents and certificates(at least one)
                <br>
                <label for="">Add Document</label>
                <input type="file" name="document" accept=".pdf,.doc,.docx" multiples required>
                <br>
                <label for="">Add Document</label>
                <input type="file" name="document" accept=".pdf,.doc,.docx" multiples>
                <br>
                <label for="">Add Document</label>
                <input type="file" name="document" accept=".pdf,.doc,.docx" multiples>
                <br>
                <label for="">Add Document</label>
                <input type="file" name="document" accept=".pdf,.doc,.docx" multiples>
                <br>
                <label for="">Add Document</label>
                <input type="file" name="document" accept=".pdf,.doc,.docx" multiples>

                <label for="">Scan QR code to pay</label>
                <img src="{% static 'images/qr.png' %}" alt="" />
                <br><br>

                <label for="">Transaction number</label>
                <input type="number" name="transation_no" id="transation_no"  placeholder="Enter Transaction Number" required>
            
            </div>
            <br><br>
            <button type="submit">Submit</button>
        </form>

        <script>
            let otpSent = false;
            let phoneVerified = false;

            function sendOTP() {
                const phoneNumber = document.getElementById('number').value;
                const sendBtn = document.getElementById('send-otp-btn');
                const statusEl = document.getElementById('phone-status');
                
                if (!phoneNumber || phoneNumber.length !== 10) {
                    statusEl.innerHTML = '<span class="error">Please enter a valid 10-digit phone number</span>';
                    return;
                }
                
                sendBtn.disabled = true;
                sendBtn.textContent = 'Sending...';
                statusEl.innerHTML = '<span class="info">Sending OTP...</span>';
                
                fetch('/send-otp/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phone_number: phoneNumber
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        statusEl.innerHTML = '<span class="success">OTP sent successfully!</span>';
                        document.getElementById('otp-section').style.display = 'block';
                        sendBtn.textContent = 'Resend OTP';
                        otpSent = true;
                    } else {
                        statusEl.innerHTML = `<span class="error">${data.message}</span>`;
                        sendBtn.textContent = 'Send OTP';
                    }
                    sendBtn.disabled = false;
                })
                .catch(error => {
                    statusEl.innerHTML = '<span class="error">Error sending OTP</span>';
                    sendBtn.disabled = false;
                    sendBtn.textContent = 'Send OTP';
                });
            }

            function verifyOTP() {
                const phoneNumber = document.getElementById('number').value;
                const otp = document.getElementById('otp-input').value;
                const statusEl = document.getElementById('otp-status');
                
                if (!otp || otp.length !== 6) {
                    statusEl.innerHTML = '<span class="error">Please enter 6-digit OTP</span>';
                    return;
                }
                
                statusEl.innerHTML = '<span class="info">Verifying...</span>';
                
                fetch('/verify-otp/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phone_number: phoneNumber,
                        otp: otp
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        statusEl.innerHTML = '<span class="success">✓ Phone number verified!</span>';
                        document.getElementById('phone-status').innerHTML = '<span class="verified-badge">✓ Verified</span>';
                        document.getElementById('phone-verified').value = 'true';
                        document.getElementById('otp-section').style.display = 'none';
                        phoneVerified = true;
                    } else {
                        statusEl.innerHTML = `<span class="error">${data.message}</span>`;
                    }
                })
                .catch(error => {
                    statusEl.innerHTML = '<span class="error">Error verifying OTP</span>';
                });
            }

            function validateForm() {
                if (!phoneVerified) {
                    alert('Please verify your phone number before submitting the form.');
                    return false;
                }
                return true;
            }

            // Disable phone number field after verification
            document.getElementById('number').addEventListener('input', function() {
                if (phoneVerified) {
                    document.getElementById('phone-status').innerHTML = '';
                    document.getElementById('phone-verified').value = 'false';
                    phoneVerified = false;
                }
            });
        </script>
        
        <script src="" async defer></script>
    </body>
</html>